<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libmd: Interactions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="libmd-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libmd
   &#160;<span id="projectnumber">-0.</span>
   </div>
   <div id="projectbrief">A molecular dynamics library optimized for soft matter</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_doc_markdown_interactions.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Interactions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="md-interactions"></a>
Interactions in libmd</h1>
<p>Interactions are of two types: pair potentials and forcetypes. In molecular dynamics, the <em>forces</em> on each particle are computed at each time step as a function of neighbouring particles, external constraints, etc. Pair porentials are a concise way of defining central forces that can be written as a gradient of a potential energy, whereas forcetypes encompass all other possibilities.</p>
<h2><a class="anchor" id="md-pairpotentials"></a>
Conservative forces</h2>
<p>Molecular dynamics simulations often include conservative forces between pairs of particles, which depend only on the distance between the two particles and act along the vector joining them. They can be written as the gradient of a potential energy \(V(r)\) that depends on the separation distance. If \(\mathbf{r}_i\) and \(\mathbf{r}_j\) are the position vectors of two particles, then the pairwise central forces on each particle are </p><p class="formulaDsp">
\[ \mathbf{F}_i = -\nabla_{\mathbf{r}_i} V(|\mathbf{r}_i-\mathbf{r}_j|) = -\mathbf{F}_j \]
</p>
<p><code>libmd</code> uses the framework of <em>particle types</em> to define pairwise interactions. Every <a class="el" href="structparticle.html">particle</a> instance has an associated <code>type</code>, an <code>unsigned int</code> stored in the <code><a class="el" href="structparticle_a252424154ec51cc2f0e9c77bb6207c9a.html#a252424154ec51cc2f0e9c77bb6207c9a" title="This particle has type number.">particle.type</a></code> variable. Interactions are defined between pairs of particle types. For instance, a system of identical particles interacting via a Yukawa potential can be set up by assigning the same particle type, say <code>0</code>, to all particles in the system, and defining a Yukawa-type interaction between the pair of particle types <code>(0,0)</code>.</p>
<p>The particle type is set while creating a <a class="el" href="structparticle.html">particle</a> instance via the <code>ptype</code> argument of the <a class="el" href="structparticle_ad330f8e1c58bc0e3aacb296da3122925.html#ad330f8e1c58bc0e3aacb296da3122925" title="Constructor.">particle&lt;dim&gt;::particle</a> constructor, and can be updated by calling the <a class="el" href="structmd_a9282fd8d82a54bb7d4f76685c3bf5432.html#a9282fd8d82a54bb7d4f76685c3bf5432" title="Update the type associated with particle p.">md&lt;dim&gt;::set_type(ui p, ui newtype)</a> function.</p>
<p>Defining a pairwise interaction between two particle types requires making a distinction between <em>pair potentials</em> and <em>interactions</em>:</p>
<ul>
<li>A <em>pair potential</em> is the definition of a potential function \(V(r)\) that may depend on some parameters in addition to the particle separation \(r\). The <a class="el" href="structmd_a9a603fe30e2611cef18b6d597335610e.html#a9a603fe30e2611cef18b6d597335610e" title="Pair potential functor.">md&lt;dim&gt;::v</a> structure stores information about pair potentials in the simulation. See the subsection on <a href="#md-pairpotentialdef">pair potentials</a> for more information.</li>
<li>An <em>interaction</em> is a combination of a pair potential and a specific set of parameters. The <a class="el" href="structmd_af03ae636b8618d85a9f7088077fef25d.html#af03ae636b8618d85a9f7088077fef25d" title="Interaction network.">md&lt;dim&gt;::network</a> structure stores information about the interactions deriving from pair potentials in the system. See the subsection on <a href="#md-interactiondef">interactions</a> for more information.</li>
</ul>
<h3><a class="anchor" id="md-pairpotentialdef"></a>
Pair potentials</h3>
<p>Pair potential functions are defined outside the <code>md&lt;dim&gt;()</code> structure, and added to the simulation using function pointers. A pair potential function takes two arguments: the separation distance <code>r</code> and a pointer <code>vector&lt;ldf&gt; &amp;params</code> to a vector of <code>float</code>s that contains the parameters needed to compute the interaction, and returns the potential energy. <code>libmd</code> uses <a href="http://en.wikipedia.org/wiki/Automatic_differentiation">automatic differentiation</a> implemented in <a class="el" href="autodiff_8libmd_8cc.html">autodiff.libmd.cc</a> to calculate the forces from the potential definition. This mandates that the potential function be defined with the first argument (the distance <code>r</code>) and the return value having a templated type: </p><div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> X&gt; X my_potential(X r,vector&lt;ldf&gt; &amp;parameters) {...}</div>
</div><!-- fragment --><p> However, the function itself can be written by treating <code>r</code> and the return value as <code>ldf</code> variables. See <a class="el" href="potentials_8libmd_8cc.html">potentials.libmd.cc</a> for example definitions of potential functions.</p>
<p>Once the potential function has been defined, a function pointer pointing to it is added to the list of potential functions <code>md&lt;dim&gt;::v.potentials</code> through a call to the <a class="el" href="structpairpotentials_a41a8b85ded4ddaf1896a5d3de69402b8.html#a41a8b85ded4ddaf1896a5d3de69402b8" title="Add a potentials.">pairpotentials::add()</a> member function of <a class="el" href="structmd_a9a603fe30e2611cef18b6d597335610e.html#a9a603fe30e2611cef18b6d597335610e" title="Pair potential functor.">md&lt;dim&gt;::v</a>. Each added potential is given a unique index, which is the return value of <code>md&lt;dim&gt;::v.add()</code>. The following command adds the potential function <code>my_potential()</code> defined above to an <code>md&lt;dim&gt;</code> instance named <code>sys</code>, and stores the associated index in <code>pidx:</code> </p><div class="fragment"><div class="line"><a class="code" href="structmd.html">md&lt;dim&gt;</a> sys;</div>
<div class="line">...</div>
<div class="line">ui pidx = sys.<a class="code" href="structmd_a9a603fe30e2611cef18b6d597335610e.html#a9a603fe30e2611cef18b6d597335610e">v</a>.<a class="code" href="structpairpotentials_a41a8b85ded4ddaf1896a5d3de69402b8.html#a41a8b85ded4ddaf1896a5d3de69402b8">add</a>(my_potential&lt;dual&gt;);</div>
</div><!-- fragment --><p> (The <code>&lt;dual&gt;</code> template argument is needed for the automatic differentiation system.) This index is then used to define interactions between pairs of particle types through calls to <a class="el" href="structmd_add32e6f0299fad6d17eea4e0c5172c5f.html#add32e6f0299fad6d17eea4e0c5172c5f" title="Add type interaction rule.">md&lt;dim&gt;::add_interaction</a> and <a class="el" href="structmd_adc523a066b2afdebc5cfd3f36fa732e6.html#adc523a066b2afdebc5cfd3f36fa732e6" title="Add type interaction rule.">md&lt;dim&gt;::add_typeinteraction</a> functions catalogued in the subsection on <a href="#md-interactiondef">interactions</a>.</p>
<h4><a class="anchor" id="autotoc_md0"></a>
Predefined pair potentials</h4>
<p><code>libmd</code> comes with some predefined pair potentials that can be combined with any choices of parameters to easily define interactions between particle types. A complete listing is available in the documentation for the <a class="el" href="potentials_8libmd_8cc.html">potentials.libmd.cc</a> file. The potentials are pre-loaded into the <code>md&lt;dim&gt;::v.potentials</code> list of every <a class="el" href="structmd.html">md</a> instance, and are to be referenced by their positions in this list. For ease of indexing, a global enum structure <a class="el" href="struct_p_o_t.html">POT</a> has been defined, with <code><a class="el" href="struct_p_o_t.html">POT</a>::&lt;potential name&gt;</code> providing the appropriate pair potential index. For instance, <a class="el" href="struct_p_o_t_a5b5bcf993bbc4ea93398fabf9f8b78f0.html#a5b5bcf993bbc4ea93398fabf9f8b78f0a8728188b5c3f783e3f9a80f000877a56">POT::COULOMB</a> is the index of the predefined <a class="el" href="potentials_8libmd_8cc_ad848edbfe46941489261f84096adb972.html#ad848edbfe46941489261f84096adb972" title="Coulomb potential functions.">COULOMB()</a> potential.</p>
<h3><a class="anchor" id="md-interactiondef"></a>
Interactions</h3>
<p>Once a potential has been added to the <a class="el" href="structmd.html">md</a> instance, it can be combined with specific values of parameters to create distinct <em>interactions</em>, which are instances of the <a class="el" href="structinteractiontype.html">interactiontype</a> structure. Each <a class="el" href="structmd.html">md</a> instance has a library of interactions, stored in <code>md&lt;dim&gt;::network.library[]</code> which is a vector of <a class="el" href="structinteractiontype.html">interactiontype</a> instances. Different interactions are indexed by their position in this vector.</p>
<p>Entries in the interaction library are added, modified and removed using the following set of functions:</p>
<ul>
<li>md&lt;dim&gt;::add_interaction(ui pidx, vector&lt;ldf&gt; &amp;parameters) creates an interaction from the pair potential indexed by <code>pidx</code> with the given parameters. The return value is the index of the interaction in <code>md&lt;dim&gt;::network.library[]</code>, which we will call <code>iidx</code>.</li>
<li>md&lt;dim&gt;::mod_interaction(ui iidx, ui pidx,vector&lt;ldf&gt; &amp;parameters) replaces the potential function and parameters of the interaction indexed by <code>iidx</code>.</li>
<li><a class="el" href="structmd_a9912870aa754f0366ea2f3b54cf5bfaa.html#a9912870aa754f0366ea2f3b54cf5bfaa" title="Delete type interaction rule.">md&lt;dim&gt;::rem_interaction(ui iidx)</a> removes the interaction indexed by <code>iidx</code>.</li>
</ul>
<p>The following set of functions assigns a particular interaction indexed by <code>iidx</code> to act between particles of types <code>type1</code> and <code>type2:</code> </p>
<ul>
<li><a class="el" href="structmd_adc523a066b2afdebc5cfd3f36fa732e6.html#adc523a066b2afdebc5cfd3f36fa732e6" title="Add type interaction rule.">md&lt;dim&gt;::add_typeinteraction(ui type1, ui type2, ui iidx)</a></li>
<li><a class="el" href="structmd_a3a632d96257e09cdd541aefb1b1f2910.html#a3a632d96257e09cdd541aefb1b1f2910" title="Modify type interaction rule.">md&lt;dim&gt;::mod_typeinteraction(ui type1, ui type2, ui iidx)</a></li>
<li><a class="el" href="structmd_ade6485112233e29238898268e6d5813c.html#ade6485112233e29238898268e6d5813c" title="Force add/mod type interaction rule.">md&lt;dim&gt;::mad_typeinteraction(ui type1, ui type2, ui iidx)</a></li>
</ul>
<p>The functions differ in their behaviour when an interaction between the pair of types has or has not been defined.</p>
<p>There is also a set of functions which allows the creation of an interaction and its assignment to act between particle types <code>type1</code> and <code>type2</code> in a single command:</p>
<ul>
<li>md&lt;dim&gt;::add_typeinteraction(ui type1, ui type2, ui pidx, vector&lt;ldf&gt; &amp;parameters)</li>
<li>md&lt;dim&gt;::mod_typeinteraction(ui type1, ui type2, ui pidx, vector&lt;ldf&gt; &amp;parameters)</li>
<li>md&lt;dim&gt;::mad_typeinteraction(ui type1, ui type2, ui pidx, vector&lt;ldf&gt; &amp;parameters)</li>
</ul>
<p>The following code snippets are therefore equivalent: </p><div class="fragment"><div class="line"><span class="comment">/* Uses predefined Hookean spring potential, indexed by POT::HOOKEAN */</span></div>
<div class="line"> </div>
<div class="line">vector&lt;ldf&gt; params = {1.0,2.0};     <span class="comment">// Vector of two parameters for a Hookean spring</span></div>
<div class="line">                                    <span class="comment">// (spring constant and rest length)</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="libmd_8h_aa0f39ee33b87675e11229913d432ffe7.html#aa0f39ee33b87675e11229913d432ffe7">ui</a> onespring = <a class="code" href="structmd_add32e6f0299fad6d17eea4e0c5172c5f.html#add32e6f0299fad6d17eea4e0c5172c5f">md&lt;dim&gt;::add_interaction</a>(<a class="code" href="struct_p_o_t_a5b5bcf993bbc4ea93398fabf9f8b78f0.html#a5b5bcf993bbc4ea93398fabf9f8b78f0a1aef82e1cdd2746810e5360f230e9994">POT::HOOKEAN</a>, &amp;params);</div>
<div class="line">                                    <span class="comment">// Create a Hookean interaction with the given parameters</span></div>
<div class="line">                                    <span class="comment">// and store its index in onespring</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="structmd_adc523a066b2afdebc5cfd3f36fa732e6.html#adc523a066b2afdebc5cfd3f36fa732e6">md&lt;dim&gt;::add_typeinteraction</a>(2,8,onespring);</div>
<div class="line">                                    <span class="comment">// Add the interaction indexed by onespring between</span></div>
<div class="line">                                    <span class="comment">// particle types 2 and 8</span></div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">/* Uses predefined Hookean spring potential, indexed by POT::HOOKEAN  */</span></div>
<div class="line"> </div>
<div class="line">vector&lt;ldf&gt; params = {1.0,2.0};     <span class="comment">// Vector of two parameters for a Hookean spring</span></div>
<div class="line">                                    <span class="comment">// (spring constant and rest length)</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="structmd_adc523a066b2afdebc5cfd3f36fa732e6.html#adc523a066b2afdebc5cfd3f36fa732e6">md&lt;dim&gt;::add_typeinteraction</a>(2,8,<a class="code" href="struct_p_o_t_a5b5bcf993bbc4ea93398fabf9f8b78f0.html#a5b5bcf993bbc4ea93398fabf9f8b78f0a1aef82e1cdd2746810e5360f230e9994">POT::HOOKEAN</a>,&amp;params);</div>
<div class="line">                                    <span class="comment">// Add a Hookean interaction between particles of</span></div>
<div class="line">                                    <span class="comment">// type 2 and type 8 with defined params</span></div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md1"></a>
Cutoff radius</h4>
<p>An important parameter in limiting unnecessary computations of pair potentials is the <em>cutoff radius</em>, a value of the particle separation beyond which the pair potential and resultant force are assumed to be zero. Each interaction (i.e. each <a class="el" href="structinteractiontype.html">interactiontype</a> instance in <code>md&lt;dim&gt;::network.library</code>[]) has a unique cutoff radius stored in the <code>rco</code> member variable. By default, this is set to be equal to the value of <code>md&lt;dim&gt;::network.rco</code>, which is the case for the examples listed above. However, every function that creates a new interaction also has a version in which the cutoff radius can be explicitly specified as an additional parameter, as follows:</p>
<ul>
<li>md&lt;dim&gt;::add_interaction(ui pidx, ldf rco, vector&lt;ldf&gt; &amp;parameters)</li>
<li>md&lt;dim&gt;::mod_interaction(ui iidx, ui pidx, ldf rco, vector&lt;ldf&gt; &amp;parameters)</li>
<li>md&lt;dim&gt;::add_typeinteraction(ui type1, ui type2, ui pidx, ldf rco, vector&lt;ldf&gt; &amp;parameters)</li>
<li>md&lt;dim&gt;::mod_typeinteraction(ui type1, ui type2, ui pidx, ldf rco, vector&lt;ldf&gt; &amp;parameters)</li>
<li>md&lt;dim&gt;::mad_typeinteraction(ui type1, ui type2, ui pidx, ldf rco, vector&lt;ldf&gt; &amp;parameters)</li>
</ul>
<h3><a class="anchor" id="autotoc_md2"></a>
Bonds</h3>
<p>A bond is a pair interaction specific to two particles. If two particles share a bond, each has a unique particle type that is not shared with any other particle in the system. As a result, the particles could have a unique interaction that is not shared by any other pair of particles in the system. (This is however not a requirement &ndash; a bond could be created between particles with an interaction type that is also present between other particle types.)</p>
<p>Bonds provide a framework to assign specific interactions to pairs of particles based on the particle ID rather than the particle type. For instance, a disordered spring network with every spring having a unique bond length or spring constant can be implemented by adding bonds among connected particles, each of which is a Hookean interaction with the appropriate parameters. Many functions exist to automate the task of adding, removing, or modifying bonds between pairs of particles without the user having to keep track of particle type assignments. These are summarized here. All such functions take two particle indices as their first two arguments. The order of the particle indices is unimportant.</p>
<p>Functions to create/modify bonds fall into two classes. The first class assigns a predefined interaction type, referenced by its index <code>iidx</code> in <code>md&lt;dim&gt;::network.library[]</code>, to the particle pair:</p>
<ul>
<li><a class="el" href="structmd_a21674b3d7fe619e81706e844e47bd564.html#a21674b3d7fe619e81706e844e47bd564" title="Add a bond.">md&lt;dim&gt;::add_bond(ui p1, ui p2, ui iidx)</a></li>
<li><a class="el" href="structmd_a0920ab1964184b3c6e533c84f3760013.html#a0920ab1964184b3c6e533c84f3760013" title="Modify a bond.">md&lt;dim&gt;::mod_bond(ui p1, ui p2, ui iidx)</a></li>
<li><a class="el" href="structmd_a514405c00064a980786fbea0d037b091.html#a514405c00064a980786fbea0d037b091" title="Force add/modify bond.">md&lt;dim&gt;::mad_bond(ui p1, ui p2, ui iidx)</a></li>
</ul>
<p>The second class creates a new interaction from a specified potential type (referenced by its index <code>pidx</code> in <code>md&lt;dim&gt;::v.potentials[]</code>) and a parameter list, and assigns this newly created interaction type to the pair of particles:</p>
<ul>
<li>md&lt;dim&gt;::add_bond(ui p1, ui p2, ui pidx, vector&lt;ldf&gt; &amp;parameters)</li>
<li>md&lt;dim&gt;::mod_bond(ui p1, ui p2, ui pidx, vector&lt;ldf&gt; &amp;parameters)</li>
<li>md&lt;dim&gt;::mad_bond(ui p1, ui p2, ui pidx, vector&lt;ldf&gt; &amp;parameters)</li>
</ul>
<p>The function <a class="el" href="structmd_aa0c8d2a3bb58c4da796d2d579a4218f4.html#aa0c8d2a3bb58c4da796d2d579a4218f4" title="Remove a bond from the system.">md&lt;dim&gt;::rem_bond</a> removes any interaction (including a pair interaction of non-bond type) between a specified pair of particles. A special convenience function <a class="el" href="structmd_ad4fa01a066c32eb0338a46e9f728875f.html#ad4fa01a066c32eb0338a46e9f728875f" title="Add a harmonic bond to the system.">md&lt;dim&gt;::add_spring</a> enables easy creation of harmonic springs of specified spring constant and rest length between specific particle pairs.</p>
<p><b>Note:</b> calling functions to add, remove, or modify bonds between particle pairs typically <b>changes the particle types</b> associated with each member of the pair. Therefore, it is best to use bond functions after all particle type and potential assignments have been completed (the bond functions will preserve type interactions through the particle reassignment).</p>
<h3><a class="anchor" id="autotoc_md3"></a>
Interactions and bonds within superparticles</h3>
<p>Interactions and bonds have a special meaning in the context of <a href="#md-superparticles">superparticles</a>.</p>
<p>A pairwise <em>interaction</em> can be defined between two particle subtypes <code>p1</code> and <code>p2</code> within a superparticle type <code>spt</code>; this interaction will then be present in all copies of <code>spt</code> in the system. The pair potentials and interactions are shared with the ordinary particles (i.e. the same libraries and indices are used), but the <code>add/mod/mad_typeinteraction</code>() functions described in the section on <a href="#md-interactiondef">interactions</a> are replaced by the following functions:</p>
<ul>
<li><a class="el" href="structmd_a5b6b06f8347c82462c21b8eb0a6d215b.html#a5b6b06f8347c82462c21b8eb0a6d215b" title="Add superparticle interaction rule.">md&lt;dim&gt;::add_sp_interaction(ui spt, ui p1, ui p2, ui iidx)</a></li>
<li>md&lt;dim&gt;::add_sp_interaction(ui spt, ui p1, ui p2, ui pidx, vector&lt;ldf&gt; &amp;parameters)</li>
<li>md&lt;dim&gt;::add_sp_interaction(ui spt, ui p1, ui p2, ui pidx, ldf rco, vector&lt;ldf&gt; &amp;parameters)</li>
</ul>
<p>(and similarly for <code>mod_sp_interaction</code> and <code>mad_sp_interaction</code>).</p>
<p>A <em>bond</em> within a superparticle is created by specifying two <em>ordinary</em> particle indices (not subtypes) <code>p1</code> and <code>p2</code> which must belong to the same superparticle. An interaction is then created between these two particles, which only exists in that particular superparticle instance, making it distinct from all other superparticles in the system. Successful superparticle bond creation always gives rise to a new superparticle type specific to the superparticle instance that has been targeted. See the following functions for more details:</p>
<ul>
<li><a class="el" href="structmd_a5f432ad2fb07d7e3d802d51ef5bec4b3.html#a5f432ad2fb07d7e3d802d51ef5bec4b3" title="Add a superparticle bond.">md&lt;dim&gt;::add_sp_bond(ui p1, ui p2, ui iidx)</a></li>
<li>md&lt;dim&gt;::add_sp_bond(ui p1, ui p2, ui pidx, vector&lt;ldf&gt; &amp;parameters)</li>
</ul>
<p>(and similarly for <code>mod_sp_bond</code> and <code>mad_sp_bond</code>).</p>
<p>Finally the functions <a class="el" href="structmd_a122d80c92758c75eb00437bbc9192e70.html#a122d80c92758c75eb00437bbc9192e70" title="Delete superparticle interaction rule.">md&lt;dim&gt;::rem_sp_interaction()</a> and <a class="el" href="structmd_a06df83013c9455b525f95deb35dd5b55.html#a06df83013c9455b525f95deb35dd5b55" title="Remove a superparticle bond from the system.">md&lt;dim&gt;::rem_sp_bond()</a> remove superparticle interactions and bonds respectively.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Non-conservative forces</h2>
<p>Many applications of molecular dynamics involve forces that cannot be defined as gradients of <a href="#md-pairpotentialdef">pair potentials</a>; e.g. dissipative drag on a particle. We use the <a class="el" href="structforcetype.html">forcetype</a> framework to define such forces on particles. This framework is completely general, and can be used to define any number of operations (not restricted to force calculation) on individual particles that can be calculated as a function of particle positions, velocities, or external parameters.</p>
<p>As with conservative forces, a distinction is to be made between <em>external force functions</em> and <em>forcetypes</em>, which are the equivalent of <em>pair potentials</em> and <em>type interactions</em> respectively. Information about external force functions is stored in the <a class="el" href="structmd_a2997460875452413182c56784f50edaf.html#a2997460875452413182c56784f50edaf" title="External forces functor.">md&lt;dim&gt;::f</a> structure, whereas the forcetypes deriving from these force functions are stored in the <a class="el" href="structmd_af03ae636b8618d85a9f7088077fef25d.html#af03ae636b8618d85a9f7088077fef25d" title="Interaction network.">md&lt;dim&gt;::network</a> structure (specifically <code>md&lt;dim&gt;::network.forces</code> and <code>md&lt;dim&gt;::network.forcelibrary</code>).</p>
<h3><a class="anchor" id="autotoc_md5"></a>
External force functions</h3>
<p>The <a class="el" href="structforcetype.html">forcetype</a> framework requires operations on particles to be represented as <em>external force functions</em>, which live outside the <code>md&lt;dim&gt;()</code> structure and fits the following prototype: </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;ui dim&gt; <span class="keywordtype">void</span> my_external_force(<a class="code" href="libmd_8h_aa0f39ee33b87675e11229913d432ffe7.html#aa0f39ee33b87675e11229913d432ffe7">ui</a> i, vector&lt;ui&gt; &amp;partners, vector&lt;ldf&gt; &amp;parameters, <span class="keywordtype">void</span> *sys) {...}</div>
</div><!-- fragment --><p> where <code>i</code> is a particle index, <code>partners</code> points to a vector of particle indices which might influence particle <code>i</code>, and <code>parameters</code> can be specified. During execution, a pointer to the <a class="el" href="structmd.html">md</a> object itself is passed to the external force function as the last argument. Under normal use, a call to <code>my_external_force()</code> function would compute a force on particle <code>i</code> that is a function of the positions and velocities of <code>i</code> and <code>partners</code>, and update the force vector <code></code>((md&lt;dim&gt;*) sys)-&gt;particles[i].F with this force. However, the external force function is not restricted to calculating and updating forces, but could modify the <a class="el" href="structmd.html">md</a> object in any way.</p>
<p>The macro <a class="el" href="macros_8libmd_8h_ae3d9f52a1a315303ad04f0576bd42a25.html#ae3d9f52a1a315303ad04f0576bd42a25">SYS</a> eases the referencing of member variables within <code>sys</code> within the <code>my_external_force()</code> function. For instance, <code></code>((md&lt;dim&gt;*) sys)-&gt;particles[i].F can be rewritten as <code>SYS-&gt;particles</code>[i].F.</p>
<p>Once an external force function has been defined, a function pointer pointing to it is added to the list of external force functions <code>md&lt;dim&gt;::f.extforces</code> through a call to the <a class="el" href="structexternalforces_a81e85285b5d21febef146fe13bdb50a5.html#a81e85285b5d21febef146fe13bdb50a5" title="Add an external force function.">externalforces::add()</a> member function of <a class="el" href="structmd_a2997460875452413182c56784f50edaf.html#a2997460875452413182c56784f50edaf" title="External forces functor.">md&lt;dim&gt;::f</a>. Each added external force function is given a unique index, which is the return value of <code>md&lt;dim&gt;::f.add()</code>. The following command adds the function <code>my_external_force()</code> to an <code>md&lt;dim&gt;</code> instance named <code>sys</code>, and stores the associated index in <code>fidx:</code> </p><div class="fragment"><div class="line"><a class="code" href="structmd.html">md&lt;dim&gt;</a> sys;</div>
<div class="line">...</div>
<div class="line">ui fidx = sys.<a class="code" href="structmd_a2997460875452413182c56784f50edaf.html#a2997460875452413182c56784f50edaf">f</a>.add(my_external_force&lt;dim&gt;);</div>
</div><!-- fragment --><p> <em>Particular</em> forcetypes are obtained by combining an external force function indexed by <code>fidx</code> with a specific set of parameters, using the <a class="el" href="structmd_a0008f4806c077d79f3ebd03a13b8ddee.html#a0008f4806c077d79f3ebd03a13b8ddee" title="Add force type.">md&lt;dim&gt;::add_forcetype</a> function catalogued in the <a href="#md-forcetypedef">following subsection</a>.</p>
<h4><a class="anchor" id="autotoc_md6"></a>
Predefined external force functions</h4>
<p><code>libmd</code> comes with two predefined external force functions, which illustrate the concept.</p>
<ul>
<li>The <a class="el" href="forces_8libmd_8cc_afdbadf91896c58754c50328fa20d2916.html#afdbadf91896c58754c50328fa20d2916">DAMPING()</a> function updates <code>SYS-&gt;particles</code>[i].F with a viscous drag force that is a function solely of the velocity of particle <code>i</code>. The corresponding force index is <code><a class="el" href="struct_e_x_t_f_o_r_c_e_ae0d69b9865d5f695184b9bd5bb549414.html#ae0d69b9865d5f695184b9bd5bb549414abe9f35c74d55b423b9adebef5d0e0e88">EXTFORCE::DAMPING</a></code>.</li>
<li>The <a class="el" href="forces_8libmd_8cc_ac068804729d4125f5c60e300c54e61c6.html#ac068804729d4125f5c60e300c54e61c6">DISSIPATION()</a> function updates <code>SYS-&gt;particles</code>[i].F with a force proportional to the velocity difference between <code>i</code> and each particle index in <code>particles</code>. The function is indexed by <a class="el" href="struct_e_x_t_f_o_r_c_e_ae0d69b9865d5f695184b9bd5bb549414.html#ae0d69b9865d5f695184b9bd5bb549414aa47a3091b3ef6c44e82af557a11bd516">EXTFORCE::DISSIPATION</a>.</li>
</ul>
<h3><a class="anchor" id="md-forcetypedef"></a>
Forcetypes</h3>
<p>An external force function indexed by <code>fidx</code> is combined with specific values of parameters and a specific list of particles associated with each particle to create distinct <em>forcetypes</em>, which are instances of the <a class="el" href="structforcetype.html">forcetype</a> structure. These are stored in <code>md&lt;dim&gt;::network.forcelibrary[]</code>, a vector of <a class="el" href="structforcetype.html">forcetype</a> instances. Different forcetypes are indexed by their position in this vector.</p>
<p>Entries in the forcetype library are added, modified and removed using the following functions, which returns a <code>bool</code> indicating the success of the operation:</p>
<ul>
<li><a class="el" href="structmd_a0008f4806c077d79f3ebd03a13b8ddee.html#a0008f4806c077d79f3ebd03a13b8ddee" title="Add force type.">md&lt;dim&gt;::add_forcetype</a>(ui fidx, vector&lt;vector&lt;ui&gt;&gt; &amp;partnerlist, vector&lt;ldf&gt; &amp;parameters) creates a forcetype from the external force function indexed by <code>fidx</code> with the given parameters. The <code>partnerlist</code> is either empty, or points to a list of lists of partner indices, so that <code></code>(&amp;partnerlist)[i] contains the partners of particle <code>i</code> to be passed to the external force function. The return value is the index of the forcetype in <code>md&lt;dim&gt;::network.forcelibrary[]</code>, which we will call <code>ftype</code>.</li>
<li><a class="el" href="structmd_a765213fe1e96156bae8b60687b763543.html#a765213fe1e96156bae8b60687b763543" title="Modify force type.">md&lt;dim&gt;::mod_forcetype</a>(ui ftype, ui fidx, vector&lt;vector&lt;ui&gt;&gt; &amp;partnerlist, vector&lt;ldf&gt; &amp;parameters) replaces the external force function and partner list of the forcetype indexed by <code>ftype</code>.</li>
<li><a class="el" href="structmd_adb0b0c0ea9c035858eadac1e2d0e1ab2.html#adb0b0c0ea9c035858eadac1e2d0e1ab2" title="Delete force type.">md&lt;dim&gt;::rem_forcetype(ui ftype)</a> removes the interaction indexed by <code>ftype</code>.</li>
</ul>
<p>Once a forcetype entry has been created, it still needs to be assigned to a particle to influence the dynamics of that particle. Forcetype assignment is handled by the following set of functions:</p>
<ul>
<li><a class="el" href="structmd_a689eedf4ef9bb0693560854d4b846eb7.html#a689eedf4ef9bb0693560854d4b846eb7" title="Assign force type to particle.">md&lt;dim&gt;::assign_forcetype(ui i, ui ftype)</a> assigns <code>ftype</code> to particle <code>i</code>.</li>
<li><a class="el" href="structmd_a2eb87929ef4c0a1bb1eebf8b310153fa.html#a2eb87929ef4c0a1bb1eebf8b310153fa" title="Assign force type to all particles.">md&lt;dim&gt;::assign_all_forcetype(ui ftype)</a> assigns <code>ftype</code> to all particles.</li>
<li>md&lt;dim&gt;::unassign_forcetype(ui ftype) and md&lt;dim&gt;::unassign_all_forcetype(ui ftype, ui i) remove the assignment of <code>ftype</code> from one or all particles.</li>
</ul>
<p>Finally, the function <a class="el" href="structmd_a9aabb9439ebd5dd2bd310adad84daac8.html#a9aabb9439ebd5dd2bd310adad84daac8" title="Clear all assigned forces.">md&lt;dim&gt;::clear_all_assigned_forcetype()</a> is useful to clear all assignments to forcetypes from all particles, although it does not remove the forcetypes themselves. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="astructmd_a2997460875452413182c56784f50edaf_html_a2997460875452413182c56784f50edaf"><div class="ttname"><a href="structmd_a2997460875452413182c56784f50edaf.html#a2997460875452413182c56784f50edaf">md::f</a></div><div class="ttdeci">externalforces&lt; dim &gt; f</div><div class="ttdoc">External forces functor.</div><div class="ttdef"><b>Definition:</b> <a href="libmd_8h_source.html#l00384">libmd.h:384</a></div></div>
<div class="ttc" id="alibmd_8h_aa0f39ee33b87675e11229913d432ffe7_html_aa0f39ee33b87675e11229913d432ffe7"><div class="ttname"><a href="libmd_8h_aa0f39ee33b87675e11229913d432ffe7.html#aa0f39ee33b87675e11229913d432ffe7">ui</a></div><div class="ttdeci">unsigned int ui</div><div class="ttdef"><b>Definition:</b> <a href="libmd_8h_source.html#l00049">libmd.h:49</a></div></div>
<div class="ttc" id="astructpairpotentials_a41a8b85ded4ddaf1896a5d3de69402b8_html_a41a8b85ded4ddaf1896a5d3de69402b8"><div class="ttname"><a href="structpairpotentials_a41a8b85ded4ddaf1896a5d3de69402b8.html#a41a8b85ded4ddaf1896a5d3de69402b8">pairpotentials::add</a></div><div class="ttdeci">ui add(potentialptr&lt; dual &gt; p)</div><div class="ttdoc">Add a potentials.</div><div class="ttdef"><b>Definition:</b> <a href="pairpotentials_8libmd_8cc_source.html#l00024">pairpotentials.libmd.cc:24</a></div></div>
<div class="ttc" id="astructmd_a9a603fe30e2611cef18b6d597335610e_html_a9a603fe30e2611cef18b6d597335610e"><div class="ttname"><a href="structmd_a9a603fe30e2611cef18b6d597335610e.html#a9a603fe30e2611cef18b6d597335610e">md::v</a></div><div class="ttdeci">pairpotentials v</div><div class="ttdoc">Pair potential functor.</div><div class="ttdef"><b>Definition:</b> <a href="libmd_8h_source.html#l00383">libmd.h:383</a></div></div>
<div class="ttc" id="astruct_p_o_t_a5b5bcf993bbc4ea93398fabf9f8b78f0_html_a5b5bcf993bbc4ea93398fabf9f8b78f0a1aef82e1cdd2746810e5360f230e9994"><div class="ttname"><a href="struct_p_o_t_a5b5bcf993bbc4ea93398fabf9f8b78f0.html#a5b5bcf993bbc4ea93398fabf9f8b78f0a1aef82e1cdd2746810e5360f230e9994">POT::HOOKEAN</a></div><div class="ttdeci">@ HOOKEAN</div><div class="ttdef"><b>Definition:</b> <a href="enums_8libmd_8h_source.html#l00013">enums.libmd.h:13</a></div></div>
<div class="ttc" id="astructmd_adc523a066b2afdebc5cfd3f36fa732e6_html_adc523a066b2afdebc5cfd3f36fa732e6"><div class="ttname"><a href="structmd_adc523a066b2afdebc5cfd3f36fa732e6.html#adc523a066b2afdebc5cfd3f36fa732e6">md::add_typeinteraction</a></div><div class="ttdeci">bool add_typeinteraction(ui type1, ui type2, ui interaction)</div><div class="ttdoc">Add type interaction rule.</div><div class="ttdef"><b>Definition:</b> <a href="interaction_8md_8libmd_8cc_source.html#l00116">interaction.md.libmd.cc:116</a></div></div>
<div class="ttc" id="astructmd_html"><div class="ttname"><a href="structmd.html">md</a></div><div class="ttdoc">This structure defines the molecular dynamics simulation.</div><div class="ttdef"><b>Definition:</b> <a href="libmd_8h_source.html#l00375">libmd.h:375</a></div></div>
<div class="ttc" id="astructmd_add32e6f0299fad6d17eea4e0c5172c5f_html_add32e6f0299fad6d17eea4e0c5172c5f"><div class="ttname"><a href="structmd_add32e6f0299fad6d17eea4e0c5172c5f.html#add32e6f0299fad6d17eea4e0c5172c5f">md::add_interaction</a></div><div class="ttdeci">ui add_interaction(ui potential, std::vector&lt; ldf &gt; &amp;parameters)</div><div class="ttdoc">Add type interaction rule.</div><div class="ttdef"><b>Definition:</b> <a href="interaction_8md_8libmd_8cc_source.html#l00025">interaction.md.libmd.cc:25</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Sep 3 2020 18:38:06 for libmd by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
